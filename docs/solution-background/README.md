# Решение
# Содержание
* [User Story](#user-story)
  * [Постановка](#постановка)
  * [Описание](#описание)
  * [Миссия](#миссия)
  * [Критерии приемки](#критерии-приемки)
  * [Дополнительные сведения](#дополнительные-сведения)
* [User cases](#user-cases)
  * [Работа с основным интерфейсом онлайн-сервиса](#работа-с-основным-интерфейсом-онлайн-сервиса)
  * [Выбор критериев удобства лестницы](#выбор-критериев-удобства-лестницы)
  * [Работа с интерфейсом приложения подбора оптимальной конфигурации лестницы](#работа-с-интерфейсом-приложения-подбора-оптимальной-конфигурации-лестницы)
  * [Работа с результатами подбора](#работа-с-результатами-подбора)
  * [Переход на страницу основного интерфейса онлайн-сервиса для работы с проектом лестницы](#переход-на-страницу-основного-интерфейса-онлайн-сервиса-для-работы-с-проектом-лестницы)
  * [Платный функционал](#платный-функционал)
  * [Задачи для реализации исполнения критериев приемки (верхне-уровневые топики)](#задачи-для-реализации-исполнения-критериев-приемки-верхне-уровневые-топики)
* [Критические сценарии и критические характеристики](#критические-сценарии-и-критические-характеристики)

# User Story
### Постановка:
Как **пользователь** онлайн-сервиса, я хочу **вводить известные размеры проема** под лестницу и **предпочитаемую форму** лестницы, чтобы онлайн-сервис автоматически подбирал **оптимальную конфигурацию** лестницы, подходящую для данного проема.

### Описание:
#### Вариант №1
- **Кто**: Пользователь, планирующий установить лестницу в своем доме.
- **Что**: Пользователь хочет указать известные ему размеры проема и форму лестницы.
- **Зачем**: Чтобы получить проект оптимальной конфигурации лестницы, подходящей для его проема.
#### Вариант №2
- **Кто**: Пользователь, планирующий установить лестницу в своем доме.
- **Когда**: Хочет получить проект оптимальной конфигурации лестницы, подходящей для его проема.
- **Тогда**: Онлайн-сервис должен подобрать оптимальную конфигурацию лестницы по известным данным о проеме пользователя, предоставить пользователю рекомендации и ссылку на выбранный проект.

### Миссия:
Упростить взаимодействие пользователя с веб-интерфейсом, предлагая пользователю вводить только известные ему данные о проеме и форме лестницы. Предоставляя взамен, быстрый подбор оптимальных вариантов конфигураций лестниц, которые можно вписать в проем пользователя. Тем самым увеличивая конверсию и вовлеченность пользователя при работе с онлайн-сервисом.

### Критерии приемки:
1. Пользователь выбирает желаемую форму лестницы: Прямая, Г-образная, П-образная.
2. Пользователь выбирает из предложенного списка форму проема в междуэтажном перекрытии, которой схематично больше всего совпадает с формой проема в междуэтажном перекрытии пользователя.
3. Пользователь вводит известный ему набор параметров проема: размеры проема, высоту от пола первого этажа до пола второго этажа, толщину междуэтажного перекрытия, доступные размеры основания на полу первого этажа, где может быть размещена лестница.
4. Система предоставляет пользователю набор критериев удобства лестницы, которые пользователь может изменить под свои предпочтения в рамках допустимых значений.
5. Система автоматически подбирает оптимальные конфигурации лестниц, удовлетворяющие критериям удобства лестницы и введенным параметрам проема.
6. Система предоставляет список оптимальных конфигураций лестниц, которые можно вписать в заданный проем.
7. Пользователь может отсортировать предложенный список лестницы по параметрам, характеризующим будущую лестницу.
8. Пользователь имеет возможность выбрать понравившуюся конфигурацию лестницы.
9. При выборе оптимальной конфигурации лестницы в браузере открывается дополнительная вкладка с онлайн-расчетом выбранной лестницы.
10. Лестница отображается в виде 3D модели, а также предоставляются чертежи и характеристики конструкции.

### Дополнительные сведения:
- Упрощение интерфейса для ввода данных.
- Возможность доработки предложенных конфигураций на основе отзывов пользователя.
- Обеспечение полезных подсказок и инструкций по вводу данных, например графические схемы.

# User cases
## Работа с основным интерфейсом онлайн-сервиса
Пользователь, находясь на веб-странице онлайн-сервиса расчета лестницы, видит кнопку, баннер или другой заметный мотивирующий к действиям блок на веб-странице, который информирует и мотивирует пользователя ускорить процесс проектирования его будущей лестницы, предлагая сделать быстрый автоматический расчет конструкции за счет подбора оптимальной конфигурации лестницы по известным параметрам проема. При клике по мотивирующему блоку, запускается дополнительный компонент страницы - всплывающее окно с программой для подбора оптимальной конфигурации лестницы. Под блоком ввода параметров проема должны располагаться две кнопки "Критерии удобства" и "Рассчитать".
## Работа с интерфейсом приложения подбора оптимальной конфигурации лестницы
### Общие характеристики
Интерфейс приложения должен быть адаптивный - корректно отображаться на мобильных устройствах, планшетах и десктопах.
Окно приложения состоит из двух основных зон-колонок. Левая колонка, занимает 1\3 ширины экрана и содержит набор полей для ввода параметров проема. Правая колонка, занимает 2\3 ширины экрана и содержит графические схемы, которые описывают расположение и значение вводимых параметров в левой колонке.
Поверх основного окна приложения могут открывать дополнительные всплывающие окна, например, для ввода критериев удобства лестницы для вывода результатов подбора оптимальных конфигураций лестницы. Все линейные размеры указываются пользователем в миллиметрах. _"Пилотная" версия будет работать только с деревянными лестницами на косоурах, в дальнейшем функционал будет расширен на другие конструктивные варианты лестниц._
### Ввод параметров проема
Пользователь вводит параметры проема в левый блок основного экрана приложения, который содержит следующие поля
* Тип лестницы
  * Прямая
  * Г-образная
  * П-образная
* Форма проема
  * Прямоугольный (для Прямой, Г и П -образной лестниц)
  * Г-образный (для Г и П -образной лестниц)
  * Г-образный обратный (для П-образной лестницы)
* Длина проема (для Г-образных проемов будет две длины проема, чтобы описать размеры формы Г)
* Ширина проема
* Допустима длина по основанию
* Высота между этажами
* Высота потолка
* Толщина междуэтажного перекрытия (должна валидироваться при подтверждении расчета как разница между значениями "Высота между этажами" минус "Высота потолка")
### Выбор критериев удобства лестницы
Критерии удобства лестницы доступны после нажатия на кнопку "Критерии удобства". По нажатию, открывается всплывающее окно, которое можно закрыть крестиком в правом верхнем углу, либо сохранить измененные критерии удобства лестницы, либо сбросить критерии удобства лестницы в значения по умолчанию.

Критерии удобства:
* Коэффициент удобства (min: 0, max: 1, def_min: 0.5, def_max_fixed: 1), как фильтр для выходного списка найденных конфигураций лестниц. Значение def_max_fixed - зафиксировано на единице. В результаты попадают конфигурации коэффициент удобства которых находится в диапазоне def_min - def_max_fixed.
* Высота подъема ступени (min: 130, max: 250, def_min: 150, def_max: 150)
* Глубина шага (min: 180, max: 310, def_min: 260, def_max: 260)
* Высота свободного пространства над лестницей (min: 1800, max: 2000, def_min: 1800, def_max: 2000)
* Свес ступени (min: 20, max: 60, def_min: 40, def_max: 40)
* Характеристика по формуле Блонделя (min: 500, max: 700, def_min: 600, def_max: 650)
* Ширина марша лестницы (min: 550, max: 2000, def_min: 900, def_max: 1000)
### Работа с результатами подбора
После ввода параметров проема, возможной корректировки критериев удобства лестницы, пользователь нажимает на кнопку Рассчитать. Прежде чем на сервер уйдет запрос на расчет, форма ввода параметров проема должна быть автоматически проверена на корректность введенных данных:
* Зависимость размеров друг от друга, это касается проверки разницы между высотой этажей и потолка, которая должна быть равна толщине междуэтажного перекрытия;
* Все введенные значения в поля - это целые положительные числа.
  После отправки запроса на подбор оптимальной конфигурации лестницы, пользователю должно отобразиться всплывающее информационно окно о процессе подбора возможных конфигураций лестниц, которое должно показывать пользователю оценочное время на подбор конфигураций, или информировать его о том, что процесс подбора производится и по окончанию расчета пользователь будет обязательно проинформирован.
  Результат расчета:
* Отсутствие подобранных конфигураций;
* Одна и более оптимальных конфигураций лестницы.
  Если подобрать оптимальные конфигурации не удалось, пользователю должно быть выведено соответсвующее информационное сообщение: "В проем с заданными параметрами не удалось подобрать лестницу, удовлетворяющую критериям удобства".

  Если конфигурации лестниц были найдены, они должны быть отображены пользователю в виде списка вариантов. Каждый элемент списка должен быть представлен набором параметров:
* Коэффициент удобства
* Угол наклона
* Формула удобства
* Формула Блонделя
* Высота ступени
* Глубина ступени
* Количество ступеней
* Ширина лестницы
* Минимальная ширина косоура
  Интерфейс должен предусматривать возможность сортировки найденных конфигураций лестницы по всем выше перечисленным параметрам, как в сторону убывания, так и в сторону возрастания. По умолчанию, список сортируется по убыванию по параметру "Коэффициент удобства", т.е. сначала отображается конфигурация лестницы с максимальным коэффициентом удобства, далее варианты с более низким коэффициентом удобства.
### Переход на страницу основного интерфейса онлайн-сервиса для работы с проектом лестницы
У каждой найденной конфигурации лестницы должна быть кнопка для перехода на страницу основного интерфейса онлайн-сервиса в расчет лестницы с заданными парамерами из выбранной конфигурации. Основной интерфейс онлайн-сервиса должен предоставить проект лестниц по заданным критериям.
### Платный функционал
Первые 5-ть позиций найденных конфигураций лестниц, с максимальным коэффициентом удобства, скрывают значения "Высоты ступеней", "Глубины ступеней", "Количества ступеней", а кнопка перехода в основной интерфейс онлайн-сервиса должна быть отключена. Это ограничение снимается при покупке доступа к результатам расчета. При попытке нажать на кнопку перехода к проекту, пользователь должен получать уведомление о том, что данный функционал доступен по подписке и ссылку или сценарий для осуществления приобретения подписки (планируется количественный доступ, например, доступ на 5, 10, 100 автоматических подборов лестниц).

### Задачи для реализации исполнения критериев приемки (верхне-уровневые топики)
#### Задачи проектирования
* Определить границы приложения. Архитектура приложения (микросервиса).
* Описать схему взаимодействия приложения с уже существующими системами C4 L1.
* Описать схему взаимодействия контейнеров приложения C4 L2.
* Описать контракты взаимодействия между системами в Swagger/AsyncAPI.
* Описать контракты SPA + backend в Swagger.
* Создать и описать карточку микросервиса.
#### Задачи на Frontend
* Подготовить пространство проекта в GIT репозитории для SPA.
* Настроить автоматический CI\CD.
* Разработать SPA на React, в соответствии с UC и UserStory.
* Реализовать наличие платного функционала в результатах расчета.
* Интегрировать SPA в основной интерфейс онлайн-сервиса как дополнительное веб-приложение.
#### Задачи на Backend
* Подготовить пространство проекта в GIT репозитории для Backend приложения.
* Выделить namespace в K8s согласно схеме развертывания из C4 L1/L2 Deployment.
* Настроить автоматический CI\CD.
* Разработать backend приложения на TypeScript используя с учетом размещения в K8s.

# НФТ
* Интерфейс приложения должен быть реализован с возможностью поддержки i18n.
* Доступ к методам расчета должен быть кросс-доменным.
* Расчет должен осуществляться менее чем за 60 секунд, или обеспечивать механизм асинхронного уведомления пользователя о завершении расчета. Или пользователю должен отображаться прогресс-бар расчета с реальным отображением времени на расчет.

# Критические сценарии и критические характеристики
## Критические сценарии:
* Пользователь легаси онлайн-сервиса Kalk.Pro выбирает и запускает на сайте проекта веб-приложение для подбора оптимальной конфигурации лестницы.
* С помощью веб-приложения подбора оптимальной конфигурации лестницы, пользователь получает набор оптимальных конфигураций лестницы в режиме онлайн. На время ожидания подбора пользователь видит прогресс выполнения процесса подбора конфигураций.
* Пользователь оплачивает доступ для получения проекта наиболее подходящей для него лестницы.
## Критические характеристики:
* "Мягкая" интеграция веб-приложения с легаси архитектурой онлайн-сервиса Kalk.Pro.
* Время подбора оптимальных конфигураций лестницы не более 1 минуты.
## Техническое решение:
* Использовать фреймворк React для создания веб-приложения и его последующей интеграции в существующий интерфейс онлайн-сервиса Kalk.Pro в качестве отдельного, независимого модуля, осуществляющего двусторонний обмен с вычислительным сервером.
* Для двустороннего обмена между приложением подбора оптимальных конфигураций лестницы использовать легаси протокол - Web-Sockets.
* Для вычислительного сервера использовать микро-сервисную архитектуру, с возможностью автоматического масштабирования ресурсов - Kubernetes.

[> На главную страницу](/README.md)