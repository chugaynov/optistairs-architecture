## ADR-002 Выбор инфраструктуры для разработки новых приложений при рефакторинге ФС Кластера проектных расчетов
#### Дата: 2025-02-22
#### Статус: Принято

## Критический сценарий
Разработка и развертывание новых микросервисов, составляющих функциональный сервис (ФС), должны быть выполнены с использованием современной инфраструктуры, обеспечивающей масштабируемость, отказоустойчивость и автоматизацию процессов.

## Критические характеристики:
* **Масштабируемость**: Возможность горизонтального масштабирования для обработки увеличивающихся нагрузок.
* **Автоматизация**: Автоматическое управление жизненным циклом приложений (развертывание, мониторинг, обновления).
* **Отказоустойчивость**: Обеспечение высокой доступности приложений даже при сбоях узлов или контейнеров.
* **Единая среда**: Использование единой инфраструктуры для всех новых приложений ФС для стандартизации процессов разработки и эксплуатации.

## Контекст
Компания Kalk.Pro планирует активно развивать функциональные сервисы и в последствии провести рефакторинг легаси сервисов с преходом на микро-сервисную архитектуру. Для этих целей требуется надежная и гибкая инфраструктура, которая позволит быстро разворачивать новые приложения, эффективно управлять их жизненным циклом и обеспечивать высокую производительность.<br>
В настоящее время используется смешанная инфраструктура на базе физических серверов и виртуальных машин (VM), что создает сложности в масштабировании, автоматизации и управлении ресурсами. Переход на современные технологии контейнеризации и оркестрации необходим для повышения эффективности разработки и эксплуатации.

### Рассматриваемые варианты решения
#### Использование Docker без оркестратора
##### Плюсы решения
* Простота внедрения контейнеризации.
* Низкий порог входа для команды, знакомой с Docker.
##### Минусы решения
* Отсутствие автоматизации управления контейнерами (масштабирование, балансировка нагрузки, самовосстановление).
* Необходимость ручного управления инфраструктурой.
* Сложности с обеспечением высокой доступности и отказоустойчивости.

#### Использование Kubernetes
##### Плюсы решения
* Масштабируемость: Возможность автоматического масштабирования приложений в зависимости от нагрузки.
* Автоматизация: Полная автоматизация развертывания, мониторинга, обновлений и восстановления приложений.
* Отказоустойчивость: Самовосстановление контейнеров и балансировка нагрузки между узлами.
* Единая платформа: Поддержка множества языков программирования и технологий, что позволяет использовать одинаковый подход для всех новых приложений.
* Большое сообщество и экосистема: Широкий выбор инструментов и готовых решений для интеграции.
##### Минусы решения
* Высокий порог входа: Требуется обучение команды для работы с Kubernetes.
* Сложность настройки: Необходимость initial-конфигурации кластера и его компонентов.
* Увеличение сложности архитектуры: Kubernetes добавляет дополнительный уровень абстракции, который может усложнить понимание системы для новичков.

#### Использование облачных сервисов (например, AWS ECS, Azure AKS, Google GKE)
##### Плюсы решения
* Управляемая инфраструктура: Облачные провайдеры предоставляют готовые решения для оркестрации контейнеров.
* Быстрое внедрение: Минимум усилий для настройки и запуска.
* Интеграция с другими облачными сервисами.
##### Минусы решения
* Зависимость от конкретного провайдера: Переход на другую платформу может быть сложным и затратным.
* Ограниченная гибкость: Некоторые функции могут быть недоступны или ограничены из-за особенностей облачного сервиса.
* Стоимость: Платные услуги могут увеличить общие расходы на инфраструктуру.

### Принятое решение
Выбран Kubernetes в качестве основной инфраструктуры для разработки и развертывания новых приложений и функциональных сервисов.

### Обоснование решения
Kubernetes предлагает наиболее полный набор функций для удовлетворения требований к масштабируемости, автоматизации и отказоустойчивости. Он предоставляет гибкую и открытую платформу, которая позволяет использовать лучшие практики DevOps и CI/CD. Кроме того, использование Kubernetes дает следующие преимущества:
* **Стандартизация**: Все новые приложения будут разворачиваться в единой инфраструктуре, что упрощает процессы разработки и эксплуатации.
* **Гибкость**: Возможность развертывать кластеры Kubernetes как в облаке, так и локально, что позволяет избежать привязки к конкретному провайдеру.
* **Широкая экосистема**: Большая база готовых инструментов и плагинов для мониторинга, безопасности, сетевого взаимодействия и других задач.
* **Поддержка сообщества**: Активное сообщество пользователей и разработчиков Kubernetes обеспечивает постоянное развитие и совершенствование платформы.

### Риски
* **Высокий порог входа**: Команде потребуется обучение для работы с Kubernetes.
    * _Митигация_: Организовать обучение и сертификацию сотрудников, а также нанять специалистов с опытом работы с Kubernetes.
* **Сложность первоначальной настройки**: Настройка кластера Kubernetes может занять значительное время.
    * _Митигация_: Использовать готовые решения для быстрой настройки (например, kubeadm, Rancher) или обратиться к профессиональным услугам по внедрению Kubernetes.
* **Увеличение сложности архитектуры**: Kubernetes добавляет новый уровень абстракции, что может усложнить понимание системы.
    * _Митигация_: Создать подробную документацию и провести обучение для всей команды.

### Митигация рисков
* Разработать план обучения для команды разработчиков технического сопровождения проекта.
* Создать детальную документацию по настройке и эксплуатации Kubernetes-кластера.
* Внедрить автоматизированные тесты для проверки работоспособности новых приложений в Kubernetes-среде.
* Рассмотреть использование готовых инфраструктурных решений на базе Kubernetes, например ДЦ Selectel или CLO.


[> На главную страницу](README.md)