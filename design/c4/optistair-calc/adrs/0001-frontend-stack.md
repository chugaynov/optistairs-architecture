# ADR-0001 Технологический стек Frontend веб-приложения для ФС

Date: 2025-02-22

## Status
Accepted

### Критический сценарий
Пользователь легаси онлайн-сервиса Kalk.Pro выбирает и запускает на сайте проекта веб-приложение для подбора оптимальной конфигурации лестницы.

### Критические характеристики:
"Мягкая" интеграция веб-приложения с легаси архитектурой онлайн-сервиса Kalk.Pro.

### Контекст
В рамках исполнения критического сценария требуется разработать и внедрить новое веб-приложение на действующий легаси сайт онлайн-сервиса Kalk.Pro, которое будет реализовывать основной пользовательский сценарий (UC) по взаимодействую пользователя с функциональными возможностями ФС Подбор оптимальной конфигурации лестницыы. При подборе технологического стека для разрабатываемого веб-приложения нужно учесть, что изменения в UI части сервиса Kalk.Pro должны быть минимальны. Минимальные изменения обеспечат сохранность существующего легаси кода, минимизируют или полностью предотвратят регресс-тестирование сценариев не связанных с UC разрабатываемого ФС. Что в свою очередь снизит стоимость внедрения и минимизирует риски повреждения уже существующего на сайте функционала.

### Артефакты проектирования UI
* [Основной интерфейс приложения (ввод размеров проема)](/design/ui-templates/opening-sizes-input.png)
* [Настройка критериев удобства лестницы](/design/ui-templates/convenience-criteria-input.png)
* [Вывод результатов подбора оптимальных конфигураций лестницы](/design/ui-templates/optimal-configurations-result.png)

### Рассматриваемые варианты решения
#### Использование backend-шаблонизатора легаси сайта + JS
Сайт онлайн-сервиса Kalk.Pro реализован на базе системы управления сайтом CMS - коробочное решение на PHP. CMS позволяет разрабатывать представления страниц сайта, отдельных компонентов UI сайта на основе PHTML-шаблонов. При запросе пользователем страниц сайта, соответствующий странице PHTML-шаблон динамически преобразуются в HTML-документ, к которому прикрепляются дополнительные ресурсы, в том числе JS-скрипты, обеспечивающие дополнительный функционал взаимодействия на стороне клиента. Для создания веб-приложения ФС Подбора оптимальных конфигураций лестницы, может быть использован подход с использованием PHTML-шаблонов и JS-скрипты для создания необходимого функционала и представления, заявленного в UC и Артефактах проектирования UI.
##### Плюсы решения
* Применяется нативная технология разработки UI, используемая на сайте Kalk.Pro, обеспечивающая полную совместимость с легаси кодом онлайн-сервиса.
* Низкий порог вхождения для команды поддержки проекта.
##### Минусы решения
* Для создания UI в рамках основного UC, потребуется написание объемного кода на JS.
* Добавление дополнительного кода в существующий набор PHTML-шаблонов потребует полного регресса в тестировании функционала сайта онлайн-сервиса Kalk.Pro, что ведет к удорожанию подхода.
* В случае рефакторинга сайта или при создании дополнительного сайта-сателлита с функциональностью подбора оптимальной конфигурации лестницы, разработанный в рамках PHTML-шаблонов UI будет непереносим. Потребуется повторная разработка.
* Специфический стек PHTML-шаблонов неизвестный широкому кругу разработчиков, усложняет поиск и подключение к проекту новых разработчиков.

#### Фреймворк React
Позволяет разрабатывать UI целиком или отдельные его части. Собирать итоговый HTML-файл с ресурсами в единый JS-build файл, который может быть подключен к сайту онлайн-сервиса Kalk.Pro в виде отдельного, независимого веб-приложения. UI на React может подгружаться и запускаться, только на определенных страницах сайт и при определенных условиях/событиях. Весь необходимый функционал и HTML представление UI части ФС Подбора оптимальных конфигураций лестницы представлен одним файлом на JS, который может быть подключен к сайту онлайн-сервиса как внешний ресурс.
##### Плюсы решения
* Подключение UI веб-приложения отдельным JS-build файлом на заданных страницах сайта.
* CSS-стили UI могут быть инкапсулированы внутри веб-приложения.
* Независимость и изоляция веб-приложения от основного сайта онлайн-сервиса.
* Взаимодействие между веб-приложением и сайтом онлайн-сервиса через внешние события.
* Отсутствие необходимости полного регресса функционала сайта онлайн-сервиса после подключения веб-приложения в силу изолированности кодовой базы сайта и веб-приложения. Как следствие - экономия времени и ресурсов на тестировании.
* Быстрая разработка UX любой сложности для UI средствами фреймворка React.
* Защита кода от копирования встроенными средствами React.
* Быстрое подключение к разработке новых разработчиков в силу большого сообщества разработчиков React. Разработка на React - "промышленный стандарт".
* Ранее реализованные веб-приложения для сайта онлайн-сервиса Kalk.Pro были разработаны на базе React, сайт уже содержит событийный интерфейс взаимодействия с такими веб-приложениями.
##### Минусы решения
* Более высокий порог включения для специалистов технического сопровождения проекта.

#### Фреймворк Vue
Аналогично React (в контексте аспектов принятия решения для ФС Подбора оптимальных конфигураций лестницы).
##### Плюсы решения
* Аналогично React (в контексте аспектов принятия решения для ФС Подбора оптимальных конфигураций лестницы).
##### Минусы решения
* Ранее на сайте онлайн-сервиса не внедрялись веб-приложения написанные на Vue.
* Приложение на Vue увеличит "зоопарк" стеков, которые нужно будет сопровождать в рамках проекта онлайн-сервиса.

### Принятое решение
Использовать фреймворк React для создания веб-приложения и его последующей интеграции в существующий интерфейс сайта онлайн-сервиса Kalk.Pro в качестве отдельного, независимого модуля, осуществляющего двусторонний обмен с вычислительным сервером.

### Последствия
* Изолированность веб-приложения, оно будет работать как независимый модуль, что минимизирует риск повреждения существующего функционала легаси системы.
* Модульная архитектура React позволяет создавать компоненты с инкапсулированными стилями и логикой, что упрощает поддержку и масштабирование приложения.
* В силу наличия большого количества готовых библиотек и компонентов, а также опыту команды (учитывая предыдущее использование React), процесс разработки станет более эффективным.
* Переносимость веб-приложения, которое может быть легко перенесено на другие сайты или интегрировано в будущие проекты без значительных изменений.

### Риски
* Дополнительная нагрузка от React-компонента может негативно повлиять на скорость загрузки страницы, особенно если сайт уже содержит другие React-компоненты.
* Добавление еще одного React-компонента к существующим увеличивает сложность общей архитектуры Frontend.
* Изоляция компонента усложняет диагностику проблем, возникающих на границе между React-частью и легаси-кодом.
* Недоступность приложения, если пользователь отключает JavaScript в браузере.

### Митигация рисков
* Провести детальное тестирование производительности после интеграции.
* Создать подробную документацию по работе и поддержке веб-приложения на React.
* Обеспечить обучение всех членов команды технического сопровождения проекта базовым принципам работы с React.
* Внедрить автоматизированные тесты для проверки совместимости нового компонента со старым кодом.
